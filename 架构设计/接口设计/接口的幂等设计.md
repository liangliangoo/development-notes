# 接口幂等设计方案

## 产生幂等性的场景
1. 网络波动，引起重试
2. 用户重复操作
3. 应用使用了实效或超时重试机制（Nginx重试 or RPC 重试 or 业务层重试）
4. 页面重复刷新
5. 浏览器历史记录重复提交表单
6. 浏览器http重试
7. 定时任务重复执行

## 应该在哪里层逻辑处理幂等问题
非幂等带来的问题无非就是数据一致性问题了，那么可以在数据访问层处理这个问题

### 非服务端处理情况
1. 当用户出发某个事件以后，将按钮设为不可用状态

### 服务端处理
1. 数据库表中使用唯一索引机制，防止数据重复写入
2. Token + redis <br>
   以订单场景为例：用户在下单前 向服务单申请Token ,服务端将其保存在redis中，客户端下单是将token 带上，校验Token 准确性，
3. 状态机
4. 乐观锁
5. 分布式锁
6. 缓冲队列<br>
   将请求都快速地接收下来后放入缓冲队列中,后续使用异步任务处理队列中的数据,过滤掉重复的请求,该解决方案优点是同步处理改成异步处理、高吞吐量,缺点则是不能及时地返回请求结果,需要后续轮询得处理结果。
7. 